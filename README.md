# Kotlin Coroutines. Домашнее задание

## Задание 1: Конкурентное выполнение корутин
Шаблон задания находится в файле [scope.kt](/src/main/kotlin/ru/otus/homework/scope).
Внутри него вы найдете функцию `runJobs`, которая запускает несколько асинхронных задач `doSomeJob` и возвращает количесво успешно завершенных задач.
В текущей реализации, если хотя бы одна из задач `doSomeJob` завершается с ошибкой (симулируется через throw RuntimeException),
отменяются все остальные дочерние корутины, и сам скоуп завершается с ошибкой.

### Ваша задача
Изменить код функций таким образом, чтобы падение одной или нескольких дочерних корутин не приводило к отмене остальных задач и основной задачи. Функция должна
корректно дожидаться выполнения всех запущенных задач и возвращать количество успешно завершенных.

### Критерии оценки
Код будет считаться верным, если успешно выполняются тесты, расположенные в файле [ScopeTest.kt](/src/test/kotlin/ru/otus/homework/scope/ScopeTest.kt).
Тесты проверяют два основных сценария:

1. Все задачи завершаются успешно.
2. Часть задач завершается с ошибкой, но остальные продолжают выполняться, и функция `runJobs` возвращает корректное число успешно выполненных задач.

## Задание 2: Загрузка данных c использованием Flow
Шаблон для этого задания находится в файле [`loading.kt`](/src/main/kotlin/ru/otus/homework/loading/loading.kt).
В этом файле вы найдете функцию `loadProfile`, которая должна асинхронно загружать профиль пользователя и возвращать состояния загрузки с помощью `Flow`.
Элементы потока данных должны быть типа [LceState<UserProfile>](/src/main/kotlin/ru/otus/homework/loading/LceState.kt), отражающие состояние загрузки:

- `LceState.Loading` - загрузка данных
- `LceState.Content` - данные загружены
- `LceState.Error` - ошибка при загрузке данных

Эмуляция сетевого запроса реализована в `NetworkService.kt` в виде синхронного метода `loadProfile`.

### Ваша задача
Реализовать функцию `loadProfile`, используя `Flow`, которая будет выполнять следующие шаги:

1.  Сразу после вызова эмитит состояние `LceState.Loading`.
2.  Выполняет сетевой запрос для загрузки профиля пользователя. **Важно:** этот запрос не должен выполняться на главном (main) потоке, чтобы не блокировать UI.
3.  Если запрос завершается успешно, функция эмитит состояние `LceState.Content` с загруженными данными.
4.  Если при выполнении запроса происходит ошибка, функция должна перехватить исключение и эмитить состояние `LceState.Error` с этим исключением.

### Критерии оценки
Код будет считаться верным, если он успешно проходит тесты, которые находятся в файле [`LoadingTest.kt`](/src/test/kotlin/ru/otus/homework/loading/LoadingTest.kt).
Эти тесты проверяют корректность состояний, которые эмитит `Flow` в случаях успешной загрузки и при сетевой ошибке.

## Задание 3: Измерение скорости сети
Шаблон для этого задания находится в файле [`speedtest.kt`](/src/main/kotlin/ru/otus/homework/speedtest/speedtest.kt).
В этом файле вы найдете функцию `measureNetworkSpeed`, которая должна измерять среднее время ответа сети, запуская несколько параллельных запросов 
с помощью `SpeedtestService`.

### Ваша задача
Реализовать функцию `measureNetworkSpeed`, которая будет выполнять следующие шаги:

1.  Конкурентно (параллельно) запускает указанное количество (`numOfRequests`) сетевых запросов, используя `service.measureRequestTime()`.
2.  Собирает результаты только успешно выполненных запросов.
3.  Вычисляет среднее время выполнения для всех успешных запросов.
4.  Если все запросы завершились неудачно, функция должна возвращать `Double.NaN`.

### Критерии оценки
Код будет считаться верным, если он успешно проходит тесты, которые находятся в файле [`SpeedtestTest.kt`](/src/test/kotlin/ru/otus/homework/speedtest/SpeedtestTest.kt).
Тесты проверяют:

1. Корректность вычисления среднего времени при успешном выполнении всех запросов.
2. Возврат `Double.NaN`, если все запросы завершились с ошибкой.
3. Что запросы выполняются конкурентно, а не последовательно.

